<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#1a1a2e">
  <title>iVnc Remote Desktop</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/icons/icon.svg">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
</head>
<body>
  <div id="app"></div>
  <script>
    (function() {
      window.__IVNC_WS_HOST__ = window.location.hostname;
      // Server replaces __IVNC_INJECTED_PORT__ with actual port (e.g., "8007")
      // The variable name __IVNC_WS_PORT__ is preserved
      const injectedPort = "__IVNC_INJECTED_PORT__";
      if (injectedPort !== "__IVNC_INJECTED_PORT__") {
        window.__IVNC_WS_PORT__ = injectedPort;
      } else {
        window.__IVNC_WS_PORT__ = "8007";
      }
      window.__IVNC_TCP_ONLY__ = false;
      fetch(`/ws-config?ts=${Date.now()}`, { cache: 'no-store' })
        .then((resp) => resp.ok ? resp.json() : null)
        .then((data) => {
          if (data && data.ws_port) {
            window.__IVNC_WS_PORT__ = String(data.ws_port);
            console.log('iVnc WS port set from ws-config', window.__IVNC_WS_PORT__);
          }
          if (data && typeof data.tcp_only === 'boolean') {
            window.__IVNC_TCP_ONLY__ = data.tcp_only;
          }
        })
        .catch((err) => {
          console.warn('iVnc ws-config fetch failed', err);
        })
        .finally(() => {
          const script = document.createElement('script');
          script.type = 'module';
          script.src = 'ivnc-core.js?v=50';
          document.head.appendChild(script);
        });
    })();
    if ('serviceWorker' in navigator) navigator.serviceWorker.register('/sw.js');
  </script>
</body>
</html>
